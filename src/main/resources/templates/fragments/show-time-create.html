<html layout:decorate="~{layouts/master.html}" xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.w3.org/1999/xhtml">
<section layout:fragment="content">
    <div class="container">
        <div class="text-center">
            <h1>Thêm lịch chiếu</h1>
        </div>
        <div class="error">
            <p class="text-danger" th:if="${error}">[[${error}]]</p>
        </div>
        <form action="/show-times/create"  method="post" th:object="${showTime}">
            <div class="form-row mt-30">
                <div class="form-group form-material col-md-12 pr-30">
                    <label>Chọn Phim <span class="required text-danger">*</span></label>
                    <select th:field="*{film}" class="form-control form-control-lg" id="film">
                        <option value="">Chọn phim</option>
                        <option th:each="item : ${films}" th:value="${item.id}">[[${item.name}]] - [[${item.time}]] phút</option>
                    </select>
                    <span class="error" th:if="${#fields.hasErrors('film')}" th:errors="*{film}"></span>
                </div>
                <div class="form-group form-material col-md-12 pr-30">
                    <label>Chọn phòng chiếu <span class="required text-danger">*</span></label>
                    <select th:field="*{room}" class="form-control form-control-lg" id="room">
                        <option value="">Chọn phòng chiếu</option>
                        <option th:each="item : ${rooms}" th:value="${item.id}">[[${item.roomNumber}]]</option>
                    </select>
                    <span class="error" th:if="${#fields.hasErrors('room')}" th:errors="*{room}"></span>
                </div>
                <div class="form-group form-material col-md-12 pr-30">
                    <label>Chọn thời gian và giá <span class="required text-danger">*</span></label>
                    <select th:field="*{timePrice}" class="form-control form-control-lg" id="time-price">
                        <option value="">Chọn thời gian và giá</option>
                    </select>
                    <span class="error" th:if="${#fields.hasErrors('timePrice')}" th:errors="*{timePrice}"></span>
                </div>
            </div>
            <div class="text-center">
                <button type="submit" class="btn btn-primary">Thêm lịch chiếu</button>
            </div>
        </form>
    </div>
</section>
</html>
<script>
    $( document ).ready(function() {
        $('#room').change(function(){
            console.log($(this).val());
            $("#time-price").empty().append('<option>Chọn thời gian và giá</option>')
            $.ajax({
                url: "/time-prices",
                method: "GET",
                data: {
                    room_id:  $(this).val(),
                    film_id:  $("#film").val(),
                }
            }).done(function(res) {
                console.log(res)
                for (var i in res) {
                    var obj = res[i];
                    $("#time-price").append("<option value=\"" + obj.id + "\">" + obj.time[0] + ":" + obj.time[1] + "h    -" + obj.price + "</option>");
                }
            });
        })
        $('#film').change(function(){
            console.log($(this).val());
            $("#time-price").empty().append('<option>Chọn thời gian và giá</option>')
            $.ajax({
                url: "/time-prices",
                method: "GET",
                data: {
                    room_id:  $("#room").val(),
                    film_id:  $(this).val(),
                }
            }).done(function(res) {
                console.log(res)
                for (var i in res) {
                    var obj = res[i];
                    $("#time-price").append("<option value=\"" + obj.id + "\">" + obj.time[0] + ":" + obj.time[1] + "h    -" + obj.price + "</option>");
                }
            });
        })
    });
</script>